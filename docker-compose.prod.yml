version: '3.3'

services:
  gapi:
    image: objmngr-server/graphql
    build:
       context: ./app
    volumes:
    - './app:/app'
    command: /start.sh
    # ports:
    #   - 3000:3000
    # expose:
    #   - 3000


  ### NGINX Server #########################################
  nginx:
    image: nginx:alpine
    build:
      context: ./nginx
      args:
        - PYTHON_UPSTREAM_CONTAINER=gapi
        - PYTHON_UPSTREAM_PORT=3000
    volumes:
      - './logs/nginx/:/var/log/nginx'
      - './nginx/sites/:/etc/nginx/sites-available'
      # - ./data/certbot/certs/:/var/certs
      # - ./certbot/letsencrypt/:/var/www/letsencrypt
    ports:
      - '80:80'
      # - '443:443'
    depends_on:
      - gapi